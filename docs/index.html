<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“• æ™ºèªè¾æ›¸</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="stylesheet.css">
</head>
<body>
  <div class="sidebar">
    <label for="searchMode">æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰:</label>
    <select id="searchMode" title="æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰">
      <option value="prefix">å‰æ–¹ä¸€è‡´</option>
      <option value="partial">éƒ¨åˆ†ä¸€è‡´</option>
      <option value="exact">å®Œå…¨ä¸€è‡´</option>
      <option value="tag">ã‚¿ã‚°æ¤œç´¢</option>
    </select>

    <input type="text" id="searchBox" placeholder="æ¤œç´¢...">
    <ul id="wordList" class="searchResults"></ul>

    <p id="placeholder" class="placeholder">
      å…¥åŠ›æ¬„ã«å˜èªã‚’å…¥åŠ›ã—ã¦<br>
      Enter/Return ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„ï½¡<br><br>
      ï¼ˆ ç¾åœ¨ã®åéŒ²èªæ•°ï¼š50 èª ï¼‰<br><br>
      âš ï¸ æœ¬è¾æ›¸å†…è”µã®ç”¨èªè¾å…¸ã¯<br>
      æ™ºå¼è¨€èªå­¦ãƒ»æ™ºå¼éŸ³æ¥½ç†è«–ã«åŸºã¥ããŸã‚ï¼Œ<br>
      ä¸€èˆ¬çš„ãªå®šç¾©ã¨ã¯ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚<br><br>
      âš ï¸ã“ã®è¾æ›¸ã¯æœªå®Œæˆã§ã™ã€‚<br>
      å˜èªãƒ»æ´»ç”¨å½¢ãƒ»èªç¾©ãªã©ã¯ï¼Œ<br>
      å¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚<br>
      ã”äº†æ‰¿ãã ã•ã„ã€‚ 
    </p>
    
        <div id="pagination" class="pagination">
          <button id="prevPage">ï¼œ å‰ã®ãƒšãƒ¼ã‚¸</button>
          <span class="bottonspan" id="pageInfo">1 / 1</span>
          <button id="nextPage">æ¬¡ã®ãƒšãƒ¼ã‚¸ ï¼</button>
        </div>
  </div>
  <div class="content">
    <div id="details">
      <p class="placeholder">å·¦å´ã®ãƒªã‚¹ãƒˆã‹ã‚‰å˜èªã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ï½¡</p>
    </div>
  </div>

  <script src="rules/nRules.js"></script>
  <script src="rules/vRules.js"></script>
  <script src="rules/aRules.js"></script>
  <script src="rules/oRules.js"></script>
  <script src="mapping.js"></script>
  <script>
    let dictionary = {};
    let searchResults = [];
    let currentPage = 1;
    const itemsPerPage = 20;
    const partsStyles = {
  "åè±¡": "meishou",
  "å‹•è©": "doushi",
  "åé£¾": "meishoku",
  "å‰¯é£¾": "fukushoku",
  "æ¥è¾": "fukuji",
  "é›¢è¾": "fukuji",
  "ä»˜ç§°è¾": "fukuji",
  "é–“æŠ•è©": "kanto",
};

function processH5Links(text) {
  return text.replace(/<h5>(.*?)<\/h5>/g, (match, innerText) => {
    const trimmedText = innerText.trim();
    const mappedLink = linkMapping[trimmedText] || trimmedText;
    if (/^https?:\/\//.test(mappedLink)) {
      return `<h5><a href="${mappedLink}" target="_blank" rel="noopener noreferrer">${trimmedText}</a></h5>`;
    }
    return `<h5><a href="#" onclick="loadWord('${mappedLink}'); return false;">${trimmedText}</a></h5>`;
  });
}

window.toggleVulgarMeaning = function(linkElem) {
      const ul = linkElem.nextElementSibling;
      if (ul.style.display === "none") {
        ul.style.display = "block";
        linkElem.textContent = "ä¿—çš„ãªæ„å‘³ã‚’éè¡¨ç¤º";
      } else {
        ul.style.display = "none";
        linkElem.textContent = "ä¿—çš„ãªæ„å‘³ã‚’è¡¨ç¤º";
      }
    };

    Promise.all([
      fetch('dic/Cdic_a.json').then(response => response.json()),
      fetch('dic/noun/Cdic_n.json').then(response => response.json()),
      fetch('dic/noun/Cdic_n2.json').then(response => response.json()),
      fetch('dic/Cdic_o.json').then(response => response.json()),
      fetch('dic/Cdic_v.json').then(response => response.json())
    ]).then(([nounData, noun2Data, verbData, adjectiveData, othersData]) => {
      dictionary = { ...nounData, ...noun2Data, ...verbData, ...adjectiveData, ...othersData };
    }).catch(error => console.error("JSONèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error));

    function extractTranslations(text) {
      const cleaned = text.replace(/ï¼»[^ï¼½]*ï¼½/g, "").replace(/ï¼ˆ[^ï¼‰]*ï¼‰/g, "").trim();
      return cleaned.split(/\s*,\s*/).filter(item => item !== "");
    }
    function removeAnnotations(text) {
      return text.replace(/ï¼»[^ï¼½]*ï¼½/g, "").replace(/ï¼ˆ[^ï¼‰]*ï¼‰/g, "").trim();
    }

    const searchBox = document.getElementById("searchBox");
    const searchModeSelect = document.getElementById("searchMode");
    const wordList = document.getElementById("wordList");
    const details = document.getElementById("details");
    const placeholder = document.getElementById("placeholder");

    const prevPageBtn = document.getElementById("prevPage");
    const nextPageBtn = document.getElementById("nextPage");
    const pageInfoSpan = document.getElementById("pageInfo");

    function showDetails(word) {
      const data = dictionary[word];
      if (!data) {
        alert("å˜èªã€Œ" + word + "ã€ã®è©³ç´°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }

      let tableHTML = "";
      let conjugations = {};

      if (data.parts === "åè±¡") {
        conjugations = getConjN(data.word, data.stem, data.stem2, data.type, data.ruletype);
        if (Object.keys(conjugations).length === 0) {
          tableHTML = `<tr><td colspan="13">ã“ã®åè©ã¯æ´»ç”¨å‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>`;
        } else {
          tableHTML = `
            <tr class="con1">
        <td class="conname">ç´ æ ¼</td>
        <td id="ans">${conjugations.ansC || ""}</td>
        <td id="ans">${conjugations.andC || ""}</td>
        <td id="ans">${conjugations.anpC || ""}</td>
        <td id="ans">${conjugations.adsC || " â€” "}</td>
        <td id="ans">${conjugations.addC || " â€” "}</td>
        <td id="ans">${conjugations.adpC || " â€” "}</td>
        <td id="ans">${conjugations.ansI || ""}</td>
        <td id="ans">${conjugations.andI || ""}</td>
        <td id="ans">${conjugations.anpI || ""}</td>
        <td id="ans">${conjugations.adsI || " â€” "}</td>
        <td id="ans">${conjugations.addI || " â€” "}</td>
        <td id="ans">${conjugations.adpI || " â€” "}</td>
      </tr>
      <tr class="con2">
        <td class="conname">ç£å½¢</td>
        <td id="fns">${conjugations.f_ansC || ""}</td>
        <td id="fns">${conjugations.f_andC || ""}</td>
        <td id="fns">${conjugations.f_anpC || ""}</td>
        <td id="fns">${conjugations.f_adsC || " â€” "}</td>
        <td id="fns">${conjugations.f_addC || " â€” "}</td>
        <td id="fns">${conjugations.f_adpC || " â€” "}</td>
        <td id="fns">${conjugations.f_ansI || ""}</td>
        <td id="fns">${conjugations.f_andI || ""}</td>
        <td id="fns">${conjugations.f_anpI || ""}</td>
        <td id="fns">${conjugations.f_adsI || " â€” "}</td>
        <td id="fns">${conjugations.f_addI || " â€” "}</td>
        <td id="fns">${conjugations.f_adpI || " â€” "}</td>
      </tr>
      <tr class="con3">
        <td class="conname">èƒ½æ ¼/å¥ªæ ¼</td>
        <td id="ens">${conjugations.e_ansC || ""}</td>
        <td id="ens">${conjugations.e_andC || ""}</td>
        <td id="ens">${conjugations.e_anpC || ""}</td>
        <td id="ens">${conjugations.e_adsC || " â€” "}</td>
        <td id="ens">${conjugations.e_addC || " â€” "}</td>
        <td id="ens">${conjugations.e_adpC || " â€” "}</td>
        <td id="ens">${conjugations.e_ansI || ""}</td>
        <td id="ens">${conjugations.e_andI || ""}</td>
        <td id="ens">${conjugations.e_anpI || ""}</td>
        <td id="ens">${conjugations.e_adsI || " â€” "}</td>
        <td id="ens">${conjugations.e_addI || " â€” "}</td>
        <td id="ens">${conjugations.e_adpI || " â€” "}</td>
      </tr>
            <tr class="con4">
              <td class="conname">ä¸æ ¼</td>
              <td id="dns">${conjugations.d_ansC || ""}</td>
              <td id="dns">${conjugations.d_andC || ""}</td>
              <td id="dns">${conjugations.d_anpC || ""}</td>
              <td id="dns">${conjugations.d_adsC || "â€”"}</td>
              <td id="dns">${conjugations.d_addC || "â€”"}</td>
              <td id="dns">${conjugations.d_adpC || "â€”"}</td>
              <td id="dns">${conjugations.d_ansI || ""}</td>
              <td id="dns">${conjugations.d_andI || ""}</td>
              <td id="dns">${conjugations.d_anpI || ""}</td>
              <td id="dns">${conjugations.d_adsI || " â€” "}</td>
              <td id="dns">${conjugations.d_addI || " â€” "}</td>
              <td id="dns">${conjugations.d_adpI || " â€” "}</td>
            </tr>
            <tr class="con5">
              <td class="conname">å‰¯é£¾æ ¼</td>
              <td id="adns">${conjugations.ad_ansC || ""}</td>
              <td id="adns">${conjugations.ad_andC || ""}</td>
              <td id="adns">${conjugations.ad_anpC || ""}</td>
              <td id="adns">${conjugations.ad_adsC || " â€” "}</td>
              <td id="adns">${conjugations.ad_addC || " â€” "}</td>
              <td id="adns">${conjugations.ad_adpC || " â€” "}</td>
              <td id="adns">${conjugations.ad_ansI || ""}</td>
              <td id="adns">${conjugations.ad_andI || ""}</td>
              <td id="adns">${conjugations.ad_anpI || ""}</td>
              <td id="adns">${conjugations.ad_adsI || " â€” "}</td>
              <td id="adns">${conjugations.ad_addI || " â€” "}</td>
              <td id="adns">${conjugations.ad_adpI || " â€” "}</td>
            </tr>
            <tr class="con6">
              <td class="conname">å±å½¢</td>
              <td id="gns">${conjugations.g_ansC || ""}</td>
              <td id="gns">${conjugations.g_andC || ""}</td>
              <td id="gns">${conjugations.g_anpC || ""}</td>
              <td id="gns">${conjugations.g_adsC || " â€” "}</td>
              <td id="gns">${conjugations.g_addC || " â€” "}</td>
              <td id="gns">${conjugations.g_adpC || " â€” "}</td>
              <td id="gns">${conjugations.g_ansI || ""}</td>
              <td id="gns">${conjugations.g_andI || ""}</td>
              <td id="gns">${conjugations.g_anpI || ""}</td>
              <td id="gns">${conjugations.g_adsI || " â€” "}</td>
              <td id="gns">${conjugations.g_addI || " â€” "}</td>
              <td id="gns">${conjugations.g_adpI || " â€” "}</td>
            </tr>
            <tr class="con7">
              <td class="conname">å‘¼ç§°å½¢</td>
              <td id="vns">${conjugations.v_ansC || ""}</td>
              <td id="vns">${conjugations.v_andC || ""}</td>
              <td id="vns">${conjugations.v_anpC || ""}</td>
              <td id="vns">${conjugations.v_adsC || " â€” "}</td>
              <td id="vns">${conjugations.v_addC || " â€” "}</td>
              <td id="vns">${conjugations.v_adpC || " â€” "}</td>
              <td id="vns">${conjugations.v_ansI || ""}</td>
              <td id="vns">${conjugations.v_andI || ""}</td>
              <td id="vns">${conjugations.v_anpI || ""}</td>
              <td id="vns">${conjugations.v_adsI || " â€” "}</td>
              <td id="vns">${conjugations.v_addI || " â€” "}</td>
              <td id="vns">${conjugations.v_adpI || " â€” "}</td>
            </tr>
            <tr class="con8">
              <td class="conname">åŒ…æ‹¬å½¢</td>
              <td id="ins">${conjugations.in_ansC || ""}</td>
              <td id="ins">${conjugations.in_andC || ""}</td>
              <td id="ins">${conjugations.in_anpC || ""}</td>
              <td id="ins">${conjugations.in_adsC || " â€” "}</td>
              <td id="ins">${conjugations.in_addC || " â€” "}</td>
              <td id="ins">${conjugations.in_adpC || " â€” "}</td>
              <td id="ins">${conjugations.in_ansI || ""}</td>
              <td id="ins">${conjugations.in_andI || ""}</td>
              <td id="ins">${conjugations.in_anpI || ""}</td>
              <td id="ins">${conjugations.in_adsI || " â€” "}</td>
              <td id="ins">${conjugations.in_addI || " â€” "}</td>
              <td id="ins">${conjugations.in_adpI || " â€” "}</td>
            </tr>
          `;
        }
      } else if (data.parts === "ä»˜ç§°è¾") {
        conjugations = getConjot(data.word, data.stem, data.type, data.ruletype);
        if (Object.keys(conjugations).length === 0) {
          tableHTML = `<tr><td colspan="13">æ´»ç”¨å‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>`;
        } else {
          tableHTML = `
            <tr class="con1">
              <td class="conname">ç´ æ ¼</td>
              <td>${conjugations.ansC || ""}</td>
              <td>${conjugations.andC || ""}</td>
              <td>${conjugations.anpC || ""}</td>
              <td>${conjugations.adsC || ""}</td>
              <td>${conjugations.addC || ""}</td>
              <td>${conjugations.adpC || ""}</td>
              <td>${conjugations.ansI || ""}</td>
              <td>${conjugations.andI || ""}</td>
              <td>${conjugations.anpI || ""}</td>
              <td>${conjugations.adsI || ""}</td>
              <td>${conjugations.addI || ""}</td>
              <td>${conjugations.adpI || ""}</td>
            </tr>
            <tr class="con2">
              <td class="conname">ç£å½¢</td>
              <td>${conjugations.f_ansC || ""}</td>
              <td>${conjugations.f_andC || ""}</td>
              <td>${conjugations.f_anpC || ""}</td>
              <td>${conjugations.f_adsC || ""}</td>
              <td>${conjugations.f_addC || ""}</td>
              <td>${conjugations.f_adpC || ""}</td>
              <td>${conjugations.f_ansI || ""}</td>
              <td>${conjugations.f_andI || ""}</td>
              <td>${conjugations.f_anpI || ""}</td>
              <td>${conjugations.f_adsI || ""}</td>
              <td>${conjugations.f_addI || ""}</td>
              <td>${conjugations.f_adpI || ""}</td>
            </tr>
            <tr class="con3">
              <td class="conname">èƒ½æ ¼/å¥ªæ ¼</td>
              <td>${conjugations.e_ansC || ""}</td>
              <td>${conjugations.e_andC || ""}</td>
              <td>${conjugations.e_anpC || ""}</td>
              <td>${conjugations.e_adsC || ""}</td>
              <td>${conjugations.e_addC || ""}</td>
              <td>${conjugations.e_adpC || ""}</td>
              <td>${conjugations.e_ansI || ""}</td>
              <td>${conjugations.e_andI || ""}</td>
              <td>${conjugations.e_anpI || ""}</td>
              <td>${conjugations.e_adsI || ""}</td>
              <td>${conjugations.e_addI || ""}</td>
              <td>${conjugations.e_adpI || ""}</td>
            </tr>
            <tr class="con4">
              <td class="conname">ä¸æ ¼</td>
              <td>${conjugations.d_ansC || ""}</td>
              <td>${conjugations.d_andC || ""}</td>
              <td>${conjugations.d_anpC || ""}</td>
              <td>${conjugations.d_adsC || ""}</td>
              <td>${conjugations.d_addC || ""}</td>
              <td>${conjugations.d_adpC || ""}</td>
              <td>${conjugations.d_ansI || ""}</td>
              <td>${conjugations.d_andI || ""}</td>
              <td>${conjugations.d_anpI || ""}</td>
              <td>${conjugations.d_adsI || ""}</td>
              <td>${conjugations.d_addI || ""}</td>
              <td>${conjugations.d_adpI || ""}</td>
            </tr>
            <tr class="con5">
              <td class="conname">å‰¯é£¾æ ¼</td>
              <td>${conjugations.ad_ansC || ""}</td>
              <td>${conjugations.ad_andC || ""}</td>
              <td>${conjugations.ad_anpC || ""}</td>
              <td>${conjugations.ad_adsC || ""}</td>
              <td>${conjugations.ad_addC || ""}</td>
              <td>${conjugations.ad_adpC || ""}</td>
              <td>${conjugations.ad_ansI || ""}</td>
              <td>${conjugations.ad_andI || ""}</td>
              <td>${conjugations.ad_anpI || ""}</td>
              <td>${conjugations.ad_adsI || ""}</td>
              <td>${conjugations.ad_addI || ""}</td>
              <td>${conjugations.ad_adpI || ""}</td>
            </tr>
            <tr class="con6">
              <td class="conname">å±å½¢</td>
              <td>${conjugations.g_ansC || ""}</td>
              <td>${conjugations.g_andC || ""}</td>
              <td>${conjugations.g_anpC || ""}</td>
              <td>${conjugations.g_adsC || ""}</td>
              <td>${conjugations.g_addC || ""}</td>
              <td>${conjugations.g_adpC || ""}</td>
              <td>${conjugations.g_ansI || ""}</td>
              <td>${conjugations.g_andI || ""}</td>
              <td>${conjugations.g_anpI || ""}</td>
              <td>${conjugations.g_adsI || ""}</td>
              <td>${conjugations.g_addI || ""}</td>
              <td>${conjugations.g_adpI || ""}</td>
            </tr>
            <tr class="con7">
              <td class="conname">å‘¼ç§°å½¢</td>
              <td>${conjugations.v_ansC || ""}</td>
              <td>${conjugations.v_andC || ""}</td>
              <td>${conjugations.v_anpC || ""}</td>
              <td>${conjugations.v_adsC || ""}</td>
              <td>${conjugations.v_addC || ""}</td>
              <td>${conjugations.v_adpC || ""}</td>
              <td>${conjugations.v_ansI || ""}</td>
              <td>${conjugations.v_andI || ""}</td>
              <td>${conjugations.v_anpI || ""}</td>
              <td>${conjugations.v_adsI || ""}</td>
              <td>${conjugations.v_addI || ""}</td>
              <td>${conjugations.v_adpI || ""}</td>
            </tr>
            <tr class="con8">
              <td class="conname">åŒ…æ‹¬å½¢</td>
              <td>${conjugations.in_ansC || ""}</td>
              <td>${conjugations.in_andC || ""}</td>
              <td>${conjugations.in_anpC || ""}</td>
              <td>${conjugations.in_adsC || ""}</td>
              <td>${conjugations.in_addC || ""}</td>
              <td>${conjugations.in_adpC || ""}</td>
              <td>${conjugations.in_ansI || ""}</td>
              <td>${conjugations.in_andI || ""}</td>
              <td>${conjugations.in_anpI || ""}</td>
              <td>${conjugations.in_adsI || ""}</td>
              <td>${conjugations.in_addI || ""}</td>
              <td>${conjugations.in_adpI || ""}</td>
            </tr>
          `;
          tableHTML2 = `
            <tr class="con1">
              <td class="conname">å˜ç´”ç›¸</td>
              <td>${conjugations.vpa0 || ""}</td>
              <td>${conjugations.vpr0 || ""}</td>
              <td>${conjugations.vf0 || ""}</td>
            </tr>
            <tr class="con4">
              <td class="conname">é€²è¡Œç›¸</td>
              <td>${conjugations.vpa1 || ""}</td>
              <td>${conjugations.vpr1 || ""}</td>
              <td>${conjugations.vf1 || ""}</td>
            </tr>
            <tr class="con2">
              <td class="conname">å®Œäº†ç›¸</td>
              <td>${conjugations.vpa2 || ""}</td>
              <td>${conjugations.vpr2 || ""}</td>
              <td>${conjugations.vf2 || ""}</td>
            </tr>
          `;
        }
      } else if (data.parts === "å‹•è©") {
        conjugations = getConjV(data.word, data.stem, data.type, data.ruletype);
        if (Object.keys(conjugations).length === 0) {
          tableHTML = `<tr><td colspan="4">ã“ã®å‹•è©ã¯æ´»ç”¨å‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>`;
        } else {
          tableHTML = `
            <tr class="con1">
              <td class="conname">å˜ç´”ç›¸</td>
              <td>${conjugations.vpa0 || ""}</td>
              <td>${conjugations.vpr0 || ""}</td>
              <td>${conjugations.vf0 || ""}</td>
            </tr>
            <tr class="con4">
              <td class="conname">é€²è¡Œç›¸</td>
              <td>${conjugations.vpa1 || ""}</td>
              <td>${conjugations.vpr1 || ""}</td>
              <td>${conjugations.vf1 || ""}</td>
            </tr>
            <tr class="con2">
              <td class="conname">å®Œäº†ç›¸</td>
              <td>${conjugations.vpa2 || ""}</td>
              <td>${conjugations.vpr2 || ""}</td>
              <td>${conjugations.vf2 || ""}</td>
            </tr>
          `;
        }
        
      } else if (data.parts === "åé£¾" || data.parts === "å‰¯é£¾") {
        conjugations = getConjA(data.word, data.stem, data.type, data.ruletype);
        if (Object.keys(conjugations).length === 0) {
          tableHTML = `<tr><td colspan="6">ã“ã®å‹•è©ã¯æ´»ç”¨å‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>`;
        } else {
        tableHTML = `
            <tr class="con1">
              <td class="conname">ç´ æ ¼ä¸€è‡´</td>
              <td>${conjugations.s || ""}</td>
              <td>${conjugations.p || ""}</td>
              <td>${conjugations.s2 || ""}</td>
              <td>${conjugations.p2 || ""}</td>
              <td>${conjugations.s3 || ""}</td>
              <td>${conjugations.p3 || ""}</td>
            </tr>
            <tr class="con2">
              <td class="conname">ç£æ ¼ä¸€è‡´</td>
              <td>${conjugations.fs || ""}</td>
              <td>${conjugations.fp || ""}</td>
              <td>${conjugations.fs2 || ""}</td>
              <td>${conjugations.fp2 || ""}</td>
              <td>${conjugations.fs3 || ""}</td>
              <td>${conjugations.fp3 || ""}</td>
            </tr>
            <tr class="con3">
              <td class="conname">ç”Ÿ/å¥ªæ ¼ä¸€è‡´</td>
              <td>${conjugations.es || ""}</td>
              <td>${conjugations.ep || ""}</td>
              <td>${conjugations.es2 || ""}</td>
              <td>${conjugations.ep2 || ""}</td>
              <td>${conjugations.es3 || ""}</td>
              <td>${conjugations.ep3 || ""}</td>
            </tr>
            <tr class="con4">
              <td class="conname">ä¸/å‘¼æ ¼ä¸€è‡´</td>
              <td>${conjugations.ds || ""}</td>
              <td>${conjugations.dp || ""}</td>
              <td>${conjugations.ds2 || ""}</td>
              <td>${conjugations.dp2 || ""}</td>
              <td>${conjugations.ds3 || ""}</td>
              <td>${conjugations.dp3 || ""}</td>
            </tr>
            <tr class="con5">
              <td class="conname">å‰¯é£¾æ ¼ä¸€è‡´</td>
              <td>${conjugations.ads || ""}</td>
              <td>${conjugations.adp || ""}</td>
              <td>${conjugations.ads2 || ""}</td>
              <td>${conjugations.adp2 || ""}</td>
              <td>${conjugations.ads3 || ""}</td>
              <td>${conjugations.adp3 || ""}</td>
            </tr>
            <tr class="con6">
              <td class="conname">å™è¿°</td>
              <td colspan="6">${conjugations.nar || ""}</td>
            </tr>
          `;
        } 
      }
      
      let meaningsHTML = "";
if (data.meaning) {
  const meanings = Array.isArray(data.meaning)
    ? data.meaning
    : data.meaning.split(",").map(s => s.trim());
  meaningsHTML = meanings.map(m => `<li class="detailList">${m}</li>`).join("");
}

if (data.vulgarMeaning) {
  let vulgarListHTML = "";
  if (Array.isArray(data.vulgarMeaning)) {
    vulgarListHTML = data.vulgarMeaning.map(item => `<li class="detailList">${item}</li>`).join("");
  } else {
    vulgarListHTML = `<li class="detailList">${data.vulgarMeaning}</li>`;
  }

  meaningsHTML += `
    <li class="detailList">
      <a href="#" class="toggleVulgar" onclick="toggleVulgarMeaning(this); return false;">ä¿—çš„ãªæ„å‘³ã‚’è¡¨ç¤º</a>
      <ul class="vulgarList" style="display: none;">
        ${vulgarListHTML}
      </ul>
    </li>
  `;
}

function toggleVulgarMeaning(linkElem) {
  const span = linkElem.nextElementSibling;
  if (span.style.display === "none") {
    span.style.display = "inline";
    linkElem.textContent = "ä¿—çš„ãªæ„å‘³ã‚’éè¡¨ç¤º";
  } else {
    span.style.display = "none";
    linkElem.textContent = "ä¿—çš„ãªæ„å‘³ã‚’è¡¨ç¤º";
  }
}   
      let leftRows = [];
      let bottomRows = [];
      leftRows.push(`<tr><th>å±æ€§</th><td>${data.parts || ""}</td></tr>`);
      leftRows.push(`<tr><th>ã‚¿ã‚°</th><td class="t-td">${data.tag ? (Array.isArray(data.tag) ? data.tag.join(", ") : data.tag) : ""}</td></tr>`);
      leftRows.push(`<tr><th>ç™ºéŸ³</th><td class="p-td">${data.pronunciation || ""}</td></tr>`);
      if (data.lexemic) {
        leftRows.push(`<tr><th>èªå½™ç´ å½¢</th><td class="maincolor">${data.lexemic}</td></tr>`);
      }

      let fixHTML = "";
      if (data.fix) {
        const fix = Array.isArray(data.fix)
        ? data.fix
        : data.fix.split(",").map(s => s.trim());
        fixHTML = fix.map(f => `<li class="fixList">${f}</li>`).join("");
      }
      if (fixHTML) {
        leftRows.push(`
        <tr>
        <th>æ¥è¾å½¢</th>
        <td class="maincolor">
        <ul>${fixHTML}</ul>
      </td>
    </tr>
  `);
}
if (data.vari) {
        leftRows.push(`<tr><th>ç•°å½¢</th><td class="variList">${data.vari}</td></tr>`);
      }

      if (data.type) {
        leftRows.push(`<tr><th>å±ˆæŠ˜å‹</th><td>${data.type || ""}</td></tr>`);;
      }
      const rowspanCount = leftRows.length;
      leftRows[0] = leftRows[0].replace(
        `<tr><th>å±æ€§</th><td>${data.parts || ""}</td>`,
        `<tr><th>å±æ€§</th><td>${data.parts || ""}</td><th rowspan="${rowspanCount}">æ„å‘³</th><td rowspan="${rowspanCount}"><ul>${meaningsHTML}</ul></td>`
      );
      
      function processH5Links(text) {
        if (Array.isArray(text)) {
          text = text.join(' ');
        }
        return text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1">$1</a>');
      }
      if (data.etymology) {
        let introHTML = "";
        if (data.etymology.intro) {
          if (Array.isArray(data.etymology.intro)) {
            introHTML = `<ul class="e-list">` +
        data.etymology.intro.map(item => `<li>${processH5Links(item)}</li>`).join('') +
        `</ul>`;
      } else {
      introHTML = `<p class="etymology-intro">${processH5Links(data.etymology.intro)}</p>`;
    }
  }
  
      let changesTable = "";
      if (data.etymology.changes && data.etymology.changes.length > 0) {
    changesTable = `<table class="inner-table"><tbody>`;
    changesTable += data.etymology.changes.map(change => {
      const note = change.note ? " " + processH5Links(change.note) : "";
      return `<tr><td>${processH5Links(change.form)}<span>${note}</span></td></tr>`;
    }).join("");
    changesTable += `</tbody></table>`;
  }
  
    if (data.etymology && (data.etymology.intro || (data.etymology.changes && data.etymology.changes.length > 0))) {
  let introHTML = "";
  if (data.etymology.intro) {
    if (Array.isArray(data.etymology.intro)) {
      introHTML = `<ul class="e-list">` +
        data.etymology.intro.map(item => `<li>${processH5Links(item)}</li>`).join('') +
        `</ul>`;
    } else {
      introHTML = `<p class="etymology-intro">${processH5Links(data.etymology.intro)}</p>`;
    }
  }
  
  let changesTable = "";
  if (data.etymology.changes && data.etymology.changes.length > 0) {
    changesTable = `<table class="inner-table"><tbody>`;
    changesTable += data.etymology.changes.map(change => {
      const note = change.note ? " " + processH5Links(change.note) : "";
      return `<tr><td>${processH5Links(change.form)}<span>${note}</span></td></tr>`;
    }).join("");
    changesTable += `</tbody></table>`;
  }
  
  bottomRows.push(`<tr><th>èªæº</th><td colspan="3">${introHTML}${changesTable}</td></tr>`);
}

if (data.explanation) {
  bottomRows.push(`<tr><th>èªç¾©</th><td colspan="3">${data.explanation}</td></tr>`);
}
}
      
      let headerClass = partsStyles[data.parts] || "default";

let detailsHTML = `
  <table>
    <thead>
      <tr>
        <th class="heading-cell ${headerClass}" colspan="4">${word}</th>
      </tr>
    </thead>
    <tbody class="detailTable">
      ${leftRows.join("\n")}
      ${bottomRows.join("\n")}
    </tbody>
  </table>
`;

let note1HTML = "";
if (data.note1) {
  const notes = Array.isArray(data.note1)
    ? data.note1
    : data.note1.split(",").map(s => s.trim());
  note1HTML = notes.map(note =>
    `<li class="noteList">${processH5Links(note)}</li>`
  ).join("");
}

    if (note1HTML) {
      detailsHTML += `<table class="detailTable">
          <tbody>
          <tr>
            <th id="stripeth">ä¸€èˆ¬è¨€èªå­¦</th>
            <td colspan="3">
          <ul>
            ${note1HTML}
          </ul> 
          </td>
          </tr>
          </tbody>
          </table>`;
        }

        let note2HTML = "";
      if (data.note2) {
  const notes = Array.isArray(data.note2)
    ? data.note2
    : data.note2.split(",").map(s => s.trim());
  note2HTML = notes.map(note => {
    const processedNote = note.replace(/<h5>(.*?)<\/h5>/g, (match, innerText) => {
      const key = innerText.replace(/^â‡’\s*/, '').trim();
      const linkWord = linkMapping[key] || key;
      return `<h5><a href="#" onclick="loadWord('${linkWord}'); return false;">${innerText.trim()}</a></h5>`;
    });
    return `<li class="noteList">${processedNote}</li>`;
  }).join("");
}

    if (note2HTML) {
      detailsHTML += `<table class="detailTable">
        <tbody>
          <tr>
            <th id="stripeth">æ™ºèªè§£èª¬</th>
            <td colspan="3">
          <ul>
            ${note2HTML}
          </ul> 
          </td>
          </tr>
          </tbody>
          </table>`;
        }

        let jpnoteHTML = "";
        if (data.jpnote) {
  const notes = Array.isArray(data.jpnote)
    ? data.jpnote
    : data.jpnote.split(",").map(s => s.trim());
    
    let jpnoteHTML = "";
if (data.jpnote) {
  const notes = Array.isArray(data.jpnote)
    ? data.jpnote
    : data.jpnote.split(",").map(s => s.trim());
  jpnoteHTML = notes.map(note =>
    `<li class="noteList">${processH5Links(note)}</li>`
  ).join("");
}
}

    if (jpnoteHTML) {
      detailsHTML += `<table class="detailTable">
        <tbody>
          <tr>
            <th id="stripeth">æ—¥æœ¬èªè§£èª¬</th>
            <td colspan="3">
          <ul>
            ${jpnoteHTML}
          </ul> 
          </td>
          </tr>
          </tbody>
          </table>`;
        }

        let ennoteHTML = "";
if (data.ennote) {
  const notes = Array.isArray(data.ennote)
    ? data.ennote
    : data.ennote.split(",").map(s => s.trim());
  ennoteHTML = notes.map(note =>
    `<li class="noteList">${processH5Links(note)}</li>`
  ).join("");
}

    if (ennoteHTML) {
      detailsHTML += `<table class="detailTable">
        <tbody>
          <tr>
            <th id="stripeth">è‹±èªè§£èª¬</th>
            <td colspan="3">
          <ul>
            ${ennoteHTML}
          </ul> 
          </td>
          </tr>
          </tbody>
          </table>`;
        }

        if (data.alert) {
    const alertData = data.alert;
    const hasA1 = !!alertData.a1;
    const hasA2 = Array.isArray(alertData.a2) && alertData.a2.length > 0;

    if (hasA1 || hasA2) {
      const a1Text = hasA1
        ? `<span style="color: red;">${alertData.a1}</span>`
        : "";

      let a2Links = "";
      if (hasA2) {
        a2Links = alertData.a2.map(obj => {
          const w = obj.word || "";
          return `<a href="#" onclick="loadWord('${w}'); return false;">${w}</a>`;
        }).join(" ");
      }

      detailsHTML += `
        <table class="detailTable">
          <tbody>
            <tr>
              <th id="stripeth">æ³¨æ„</th>
              <td colspan="3">
                ${a1Text} <br><br>
                ${a2Links ? " " + a2Links : ""}
              </td>
            </tr>
          </tbody>
        </table>
      `;
    }
  }

      if (data.examples && data.examples.length) {
        detailsHTML += `<table class="detailTable">
          <tbody>
            <tr>
              <th>ä¾‹æ–‡</th>
              <td colspan="3">${data.examples.join("<br>")}</td>
            </tr>
          </tbody>
        </table>`;
      }

      if (data.variants1 && data.variants1.length) {
        const links = data.variants1.map(v => `<a href="#" onclick="loadWord('${v}'); return false;">${v}</a>`).join(", ");
        detailsHTML += `<table class="detailTable">
          <tbody>
            <tr>
              <th>é¡ç¾©èª</th>
              <td class="linktext" colspan="3">${links}</td>
            </tr>
          </tbody>
        </table>`;
      }

      if (data.variants3 && data.variants3.length) {
        const links = data.variants3.map(v => `<a href="#" onclick="loadWord('${v}'); return false;">${v}</a>`).join(", ");
        detailsHTML += `<table class="detailTable">
          <tbody>
            <tr>
              <th>é–¢é€£èª</th>
              <td class="linktext" colspan="3">${links}</td>
            </tr>
          </tbody>
        </table>`;
      }

      let note3HTML = "";
      if (data.note3) {
  const notes = Array.isArray(data.note3)
    ? data.note3
    : data.note3.split(",").map(s => s.trim());
  note3HTML = notes.map(note => {
    const processedNote = note.replace(/<h5>(.*?)<\/h5>/g, (match, innerText) => {
      const key = innerText.replace(/^â‡’\s*/, '').trim();
      const linkWord = linkMapping[key] || key;
      return `<h5><a href="#" onclick="loadWord('${linkWord}'); return false;">${innerText.trim()}</a></h5>`;
    });
    return `<li class="noteList">${processedNote}</li>`;
  }).join("");
}

    if (note3HTML) {
      detailsHTML += `<table class="detailTable">
        <tbody>
          <tr>
            <th id="stripeth">å‚™è€ƒ</th>
            <td colspan="3">
          <ul>
            ${note3HTML}
          </ul> 
          </td>
          </tr>
          </tbody>
          </table>`;
        }


      if (tableHTML !== "") {
        if (data.parts === "åè±¡") {
          detailsHTML += `<table>
            <thead>
              <tr class="conH1" id="conH1">
                <th colspan="13">å±ˆæŠ˜å‹</th>
              </tr>
              <tr class="conH2">
                <th rowspan="3"></th>
                <th colspan="6">å¯è¦–åè©</th>
                <th colspan="6">ä¸å¯è¦–åè©</th>
              </tr>
              <tr class="conH2">
                <th colspan="3">éé™å®šå½¢</th>
                <th colspan="3">é™å®šå½¢</th>
                <th colspan="3">éé™å®šå½¢</th>
                <th colspan="3">é™å®šå½¢</th>
              </tr>
              <tr class="conH2">
                <th>å˜æ•°</th>
                <th>åŒæ•°</th>
                <th>è¤‡æ•°</th>
                <th>å˜æ•°</th>
                <th>åŒæ•°</th>
                <th>è¤‡æ•°</th>
                <th>å˜æ•°</th>
                <th>åŒæ•°</th>
                <th>è¤‡æ•°</th>
                <th>å˜æ•°</th>
                <th>åŒæ•°</th>
                <th>è¤‡æ•°</th>
              </tr>
            </thead>
            <tbody>
              ${tableHTML}
            </tbody>
          </table>`;

        } else if (data.parts === "ä»˜ç§°è¾") {
          detailsHTML += `<table>
            <thead>
              <tr class="conH1" id="conH1">
                <th colspan="13">å±ˆæŠ˜å‹ï¼ˆåè©ç”¨æ³•ï¼‰</th>
              </tr>
              <tr class="conH2">
                <th rowspan="3"></th>
                <th colspan="6">å¯è¦–åè©</th>
                <th colspan="6">ä¸å¯è¦–åè©</th>
              </tr>
              <tr class="conH2">
                <th colspan="3">éé™å®šå½¢</th>
                <th colspan="3">é™å®šå½¢</th>
                <th colspan="3">éé™å®šå½¢</th>
                <th colspan="3">é™å®šå½¢</th>
              </tr>
              <tr class="conH2">
                <th>å˜æ•°</th>
                <th>åŒæ•°</th>
                <th>è¤‡æ•°</th>
                <th>å˜æ•°</th>
                <th>åŒæ•°</th>
                <th>è¤‡æ•°</th>
                <th>å˜æ•°</th>
                <th>åŒæ•°</th>
                <th>è¤‡æ•°</th>
                <th>å˜æ•°</th>
                <th>åŒæ•°</th>
                <th>è¤‡æ•°</th>
              </tr>
            </thead>
            <tbody>
              ${tableHTML}
            </tbody>
          </table>`;
          detailsHTML += `<table>
            <thead>
              <tr class="conH1" id="conH1">
                <th colspan="4">å±ˆæŠ˜å‹ï¼ˆå‹•è©ç”¨æ³•ï¼‰</th>
              </tr>
              <tr class="conH2">
                <th></th>
                <th>éå»</th>
                <th>ç¾åœ¨</th>
                <th>æœªæ¥</th>
              </tr>
            </thead>
            <tbody>
              ${tableHTML2}
            </tbody>
          </table>`;
        } else if (data.parts === "å‹•è©") {
          detailsHTML += `<table>
            <thead>
              <tr class="conH1" id="conH1">
                <th colspan="4">å±ˆæŠ˜å‹</th>
              </tr>
              <tr class="conH2">
                <th></th>
                <th>éå»</th>
                <th>ç¾åœ¨</th>
                <th>æœªæ¥</th>
              </tr>
            </thead>
            <tbody>
              ${tableHTML}
            </tbody>
          </table>`;

        } else if (data.parts === "åé£¾") {
          detailsHTML += `<table>
             <thead>
              <tr class="conH1" id="conH1">
                <th colspan="7">å±ˆæŠ˜è¡¨</th>
              </tr>
              <tr class="conH2">
                <th rowspan="2"></th>
                <th colspan="2">åŸç´š</th>
                <th colspan="2">æ¯”è¼ƒç´š</th>
                <th colspan="2">æœ€ä¸Šç´š</th>
              </tr>
              <tr class="conH2">
                <th>å˜æ•°</th>
                <th>è¤‡æ•°</th>
                <th>å˜æ•°</th>
                <th>è¤‡æ•°</th>
                <th>å˜æ•°</th>
                <th>è¤‡æ•°</th>
              </tr>
            </thead>
            <tbody>
              ${tableHTML}
            </tbody>
          </table>`;
        } else if (data.parts === "å‰¯é£¾") {
          detailsHTML += `<table>
            <thead class="conH">
              <tr>
                <th>å½¢æ…‹</th>
                <th>åŸºæœ¬å½¢</th>
                <th>æ¯”è¼ƒç´š</th>
                <th>æœ€ä¸Šç´š</th>
              </tr>
            </thead>
            <tbody>
              ${tableHTML}
            </tbody>
          </table>`;
        } else {
          detailsHTML += `<table>
            <tbody>
              ${tableHTML}
            </tbody>
          </table>`;
        }
      }
      
      details.innerHTML = detailsHTML;
    }
    
    window.loadWord = function(word) {
      showDetails(word);
    };

    // å˜èªãƒªã‚¹ãƒˆã®ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
    function createWordListItem(word) {
      const data = dictionary[word];
      const li = document.createElement("li");
      let meaningText = data.meaning
        ? (Array.isArray(data.meaning) ? data.meaning.join(', ') : data.meaning)
        : "";
      const translations = extractTranslations(meaningText);
      let displayText = translations.join(', ');

      const maxLength = 20;
      if (displayText.length > maxLength) {
        displayText = displayText.substring(0, maxLength) + "â€¦â€¦";
      }

      let headerClass = partsStyles[data.parts] || "default";
      li.innerHTML = `<strong class="${headerClass}">${word}</strong><br><span class="pagespan">${displayText}</span>`;
      li.addEventListener("click", () => {
        showDetails(word);
      });
      return li;
    }

    // ãƒšãƒ¼ã‚¸è¡¨ç¤ºç”¨ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
    function renderPage() {
      wordList.innerHTML = "";
      const totalPages = Math.ceil(searchResults.length / itemsPerPage);
      if (totalPages === 0) {
        const li = document.createElement("li");
        li.textContent = "è©²å½“ã™ã‚‹å˜èªã¯ã‚ã‚Šã¾ã›ã‚“ï½¡";
        li.style.color = "gray";
        wordList.appendChild(li);
        pageInfoSpan.textContent = "0 / 0";
        prevPageBtn.disabled = true;
        nextPageBtn.disabled = true;
        return;
      }
      if (currentPage < 1) currentPage = 1;
      if (currentPage > totalPages) currentPage = totalPages;
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const pageItems = searchResults.slice(startIndex, endIndex);
      pageItems.forEach(item => {
        if (item.type === "heading") {
          const li = document.createElement("li");
          li.textContent = item.text;
          li.style.fontWeight = "bold";
          li.style.color = "#6d6d6d";
          li.style.backgroundColor = "#ece9e5";
          wordList.appendChild(li);
        } else if (item.type === "word") {
          wordList.appendChild(createWordListItem(item.value));
        }
      });
      pageInfoSpan.textContent = `${currentPage} / ${totalPages}`;
      prevPageBtn.disabled = (currentPage === 1);
      nextPageBtn.disabled = (currentPage === totalPages);
    }

    // æ¤œç´¢å‡¦ç†ã®é–¢æ•°
    function performSearch() {
      const searchTerm = searchBox.value.toLowerCase();
      wordList.innerHTML = "";
      details.innerHTML = `<p class="placeholder">å·¦å´ã®ãƒªã‚¹ãƒˆã‹ã‚‰å˜èªã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ï½¡</p>`;

      if (searchTerm === "") {
        placeholder.style.display = "block";
        searchResults = [];
        pageInfoSpan.textContent = "0 / 0";
        prevPageBtn.disabled = true;
        nextPageBtn.disabled = true;
        return;
      } else {
        placeholder.style.display = "none";
      }

      if (Object.keys(dictionary).length === 0) {
        wordList.innerHTML = "<li>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</li>";
        return;
      }

      const searchMode = searchModeSelect.value;

      // ã‚¿ã‚°æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ã€ã‚¿ã‚°ã®ã¿ã§æ¤œç´¢ã™ã‚‹
      if (searchMode === "tag") {
        const tagResults = Object.keys(dictionary).filter(word => {
          const data = dictionary[word];
          let matchTag = false;
          if (data.tag) {
            if (Array.isArray(data.tag)) {
              matchTag = data.tag.some(t => removeAnnotations(t).toLowerCase() === searchTerm);
            } else {
              matchTag = removeAnnotations(data.tag).toLowerCase() === searchTerm;
            }
          }
          return matchTag;
        });
        tagResults.sort((a, b) => a.localeCompare(b));
        searchResults = [];
        if (tagResults.length > 0) {
          searchResults.push({ type: "heading", text: "ã€ã‚¿ã‚°ã§ã®æ¤œç´¢çµæœã€‘" });
          tagResults.forEach(word => {
            searchResults.push({ type: "word", value: word });
          });
        }
      } else {
        // ç¶´ã‚Šãƒ»æ„å‘³ãƒ»é–¢é€£èªãƒ»ã‚¿ã‚°ã‚’ç·åˆçš„ã«æ¤œç´¢ã™ã‚‹å‡¦ç†
        const primaryResults = Object.keys(dictionary).filter(word => {
          const data = dictionary[word];
          const cleanedWord = removeAnnotations(word).toLowerCase();
          let matchKey = false;
          if (searchMode === "exact") {
            matchKey = (cleanedWord === searchTerm);
          } else if (searchMode === "prefix") {
            matchKey = cleanedWord.startsWith(searchTerm);
          } else {
            matchKey = cleanedWord.includes(searchTerm);
          }
          let matchMeaning = false;
          if (data.meaning) {
            if (Array.isArray(data.meaning)) {
              matchMeaning = data.meaning.some(m => {
                const cleaned = removeAnnotations(m).toLowerCase();
                if (searchMode === "exact") return cleaned === searchTerm;
                else if (searchMode === "prefix") return cleaned.startsWith(searchTerm);
                else return cleaned.includes(searchTerm);
              });
            } else {
              const meaningLower = removeAnnotations(data.meaning).toLowerCase();
              if (searchMode === "exact") {
                matchMeaning = (meaningLower === searchTerm);
              } else if (searchMode === "prefix") {
                matchMeaning = meaningLower.startsWith(searchTerm);
              } else {
                matchMeaning = meaningLower.includes(searchTerm);
              }
            }
          }
          let matchVulgar = false;
          if (data.vulgarMeaning) {
            if (Array.isArray(data.vulgarMeaning)) {
              matchVulgar = data.vulgarMeaning.some(v => {
                const cleaned = removeAnnotations(v).toLowerCase();
                if (searchMode === "exact") return cleaned === searchTerm;
                else if (searchMode === "prefix") return cleaned.startsWith(searchTerm);
                else return cleaned.includes(searchTerm);
              });
            } else {
              const cleaned = removeAnnotations(data.vulgarMeaning).toLowerCase();
              if (searchMode === "exact") {
                matchVulgar = (cleaned === searchTerm);
              } else if (searchMode === "prefix") {
                matchVulgar = cleaned.startsWith(searchTerm);
              } else {
                matchVulgar = cleaned.includes(searchTerm);
              }
            }
          }
          let matchVariants2 = false;
          if (data.variants2) {
            matchVariants2 = data.variants2.some(v => {
              const cleaned = removeAnnotations(v).toLowerCase();
              if (searchMode === "exact") return cleaned === searchTerm;
              else if (searchMode === "prefix") return cleaned.startsWith(searchTerm);
              else return cleaned.includes(searchTerm);
            });
          }
          return matchKey || matchMeaning || matchVariants2 || matchVulgar;
        });

        const variantResults = Object.keys(dictionary).filter(word => {
          const data = dictionary[word];
          let matchVariants1 = false;
          if (data.variants1) {
            matchVariants1 = data.variants1.some(v => {
              const cleaned = removeAnnotations(v).toLowerCase();
              if (searchMode === "exact") return cleaned === searchTerm;
              else if (searchMode === "prefix") return cleaned.startsWith(searchTerm);
              else return cleaned.includes(searchTerm);
            });
          }
          return matchVariants1;
        });

        const tagResults = Object.keys(dictionary).filter(word => {
          const data = dictionary[word];
          let matchTag = false;
          if (data.tag) {
            if (Array.isArray(data.tag)) {
              matchTag = data.tag.some(t => removeAnnotations(t).toLowerCase() === searchTerm);
            } else {
              matchTag = removeAnnotations(data.tag).toLowerCase() === searchTerm;
            }
          }
          return matchTag;
        });

        const primarySet = new Set(primaryResults);
        const variantOnlyResults = variantResults.filter(word => !primarySet.has(word));
        const variantSet = new Set(variantOnlyResults);
        const tagOnlyResults = tagResults.filter(word => !primarySet.has(word) && !variantSet.has(word));

        primaryResults.sort((a, b) => a.localeCompare(b));
        variantOnlyResults.sort((a, b) => a.localeCompare(b));
        tagOnlyResults.sort((a, b) => a.localeCompare(b));

        searchResults = [];
        if (primaryResults.length > 0) {
          searchResults.push({ type: "heading", text: "ã€ç¶´ã‚Šãƒ»æ„å‘³ã§ã®æ¤œç´¢çµæœã€‘" });
          primaryResults.forEach(word => {
            searchResults.push({ type: "word", value: word });
          });
        }
        if (variantOnlyResults.length > 0) {
          searchResults.push({ type: "heading", text: "ã€é–¢é€£èªã§ã®æ¤œç´¢çµæœã€‘" });
          variantOnlyResults.forEach(word => {
            searchResults.push({ type: "word", value: word });
          });
        }
        if (tagOnlyResults.length > 0) {
          searchResults.push({ type: "heading", text: "ã€ã‚¿ã‚°ã§ã®æ¤œç´¢çµæœã€‘" });
          tagOnlyResults.forEach(word => {
            searchResults.push({ type: "word", value: word });
          });
        }
      }

      if (searchResults.length === 0) {
        const li = document.createElement("li");
        li.textContent = "è©²å½“ã™ã‚‹å˜èªã¯ã‚ã‚Šã¾ã›ã‚“ï½¡";
        li.style.color = "gray";
        wordList.appendChild(li);
        pageInfoSpan.textContent = "0 / 0";
        prevPageBtn.disabled = true;
        nextPageBtn.disabled = true;
        return;
      }

      currentPage = 1;
      renderPage();
    }
    
    searchBox.addEventListener("input", performSearch);
    searchModeSelect.addEventListener("change", performSearch);

    prevPageBtn.addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        renderPage();
      }
    });
    nextPageBtn.addEventListener("click", () => {
      currentPage++;
      renderPage();
    });

  </script>
</body>
</html>
